<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Play Channel</title>
    <style>
        #player {
            position: absolute;
            width: 100% !important;
            height: 100% !important;
        }
    </style>
</head>
<body>
    <div id="player"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/3.0.0/shaka-player.compiled.js"></script>
    <script>
        const queryString = window.location.search;
        const urlParams = new URLSearchParams(queryString);
        const channelId = urlParams.get('id');

        fetch("https://universe-cors.deno.dev/https://universe-channels.deno.dev/channels.json")
            .then(response => response.json())
            .then(data => {
                const channel = data.data.channels.find(item => item.id === channelId);

                if (channel) {
                    const player = new shaka.Player(document.getElementById('player'));
                    player.configure({
                        manifest: {
                            dash: {
                                clockSyncUri: channel.manifest_url,
                                customScheme: {
                                    schemeIdUri: 'urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed',
                                    interpretContentProtection: function(node) {
                                        if (node.getAttribute('value') == 'com.widevine.alpha') {
                                            return 'com.widevine.alpha';
                                        } else {
                                            return '';
                                        }
                                    }
                                }
                            }
                        }
                    });

                    player.load(channel.manifest_url).then(() => {
                        console.log('Player ready');
                    }).catch(error => {
                        console.error('Error loading channel:', error);
                    });
                } else {
                    console.error("Channel with ID", channelId, "not found");
                }
            })
            .catch(error => {
                console.error("Error loading channel data:", error);
            });
    </script>
</body>
</html>
