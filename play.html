<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Play Channel</title>
    <script src="https://content.jwplatform.com/libraries/KB5zFt7A.js"></script>
</head>
<body>
    <div id="loading">Loading...</div>
    <div id="player"></div>

    <script>
        const queryString = window.location.search;
        const urlParams = new URLSearchParams(queryString);
        const channelId = urlParams.get('id');

        fetch("https://universe-cors.deno.dev/https://iptv-universe.vercel.app/api/getM3u")
            .then(response => response.text())
            .then(playlist => {
                const channelURL = getChannelURL(playlist, channelId);

                if (channelURL) {
                    const playerInstance = jwplayer("player").setup({
                        controls: true,
                        autostart: true,
                        stretching: "exactfit",
                        playlist: [{
                            sources: [{
                                file: channelURL
                            }]
                        }]
                    });

                    playerInstance.on('ready', () => {
                        document.getElementById('loading').style.display = 'none';
                    });
                } else {
                    console.error("Channel with ID", channelId, "not found");
                    document.getElementById('loading').textContent = "Channel not found";
                }
            })
            .catch(error => {
                console.error(error);
                document.getElementById('loading').textContent = "Error loading channel";
            });

        function getChannelURL(playlist, channelId) {
            const lines = playlist.split('\n');

            for (let i = 0; i < lines.length; i++) {
                if (lines[i].includes(`tvg-id="${channelId}"`)) {
                    return lines[i + 1].trim();
                }
            }

            return null;
        }
    </script>
</body>
</html>
