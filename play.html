<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Play Channel</title>
    <style>
        #player {
            position: absolute;
            width: 100% !important;
            height: 100% !important;
        }
    </style>
</head>
<body>
    <div id="player"></div>

    <script src="https://content.jwplatform.com/libraries/KB5zFt7A.js"></script>
    <script>
        const queryString = window.location.search;
        const urlParams = new URLSearchParams(queryString);
        const channelId = urlParams.get('id');

        fetch("https://universe-cors.deno.dev/https://universe-playlist.deno.dev/channels.json")
            .then(response => response.json())
            .then(data => {
                const channel = data.find(item => item.id === channelId);

                if (channel) {
                    const playerInstance = jwplayer("player").setup({
                        controls: true,
                        sharing: true,
                        displaytitle: true,
                        autostart: false,
                        stretching: "exactfit",
                        displaydescription: true,

                        captions: {
                            color: "#FFF",
                            fontSize: 14,
                            backgroundOpacity: 0,
                            edgeStyle: "raised",
                        },

                        playlist: [
                            {
                                title: channel.name,
                                description: "",
                                image: channel.logo,
                                sources: [
                                    {
                                        file: channel.url,
                                        drm: {
                                            widevine: {
                                                licenseUrl: channel.license_key,
                                                key: channel.k,
                                                keyId: channel.kid,
                                            }
                                        },
                                    },
                                ],
                            },
                        ],
                    });

                    playerInstance.on('ready', () => {
                        console.log('Player ready');
                    });
                } else {
                    console.error("Channel with ID", channelId, "not found");
                }
            })
            .catch(error => {
                console.error("Error loading channel data:", error);
            });
    </script>
</body>
</html>
